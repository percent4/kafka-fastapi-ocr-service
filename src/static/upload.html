<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ‰¹é‡ä¸Šä¼ å›¾ç‰‡</title>

    <!-- å¼•å…¥ Bootstrap æ ·å¼ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">

    <h2 class="text-center mb-4">æ‰¹é‡ä¸Šä¼ å›¾ç‰‡ï¼ˆOCR è¯†åˆ«ï¼‰</h2>

    <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
    <div class="mb-3">
        <input type="file" class="form-control" id="fileInput" multiple>
    </div>

    <!-- æŒ‰é’®åŒºåŸŸ -->
    <div class="d-flex gap-2">
        <button class="btn btn-primary flex-fill" onclick="uploadImages()">ğŸ“¤ ä¸Šä¼ å›¾ç‰‡</button>
        <button class="btn btn-outline-danger flex-fill" onclick="clearFiles()">ğŸ—‘ æ¸…ç©ºå›¾ç‰‡</button>
    </div>

    <!-- è¿›åº¦æ¡ -->
    <div id="progressContainer" class="d-none mt-3">
        <div class="progress">
            <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%"></div>
        </div>
        <p id="progressText" class="text-center mt-2">ç­‰å¾…ä¸Šä¼ ...</p>
    </div>

    <!-- è¿™é‡Œä¸ç›´æ¥å†™ hrefï¼Œä½¿ç”¨ JavaScript æ§åˆ¶ -->
    <button class="btn btn-success w-100 mt-3" onclick="redirectToResults()">ğŸ” æŸ¥çœ‹ OCR è¯†åˆ«ç»“æœ</button>

    <script>
        /** ğŸ“¤ ä¸Šä¼ å›¾ç‰‡å¹¶è°ƒç”¨åç«¯ API */
        async function uploadImages() {
            let files = document.getElementById("fileInput").files;
            if (files.length === 0) {
                alert("âŒ è¯·é€‰æ‹©è‡³å°‘ä¸€å¼ å›¾ç‰‡ï¼");
                return;
            }

            let progressContainer = document.getElementById("progressContainer");
            let progressBar = document.getElementById("progressBar");
            let progressText = document.getElementById("progressText");

            progressContainer.classList.remove("d-none");
            progressBar.style.width = "0%";
            progressText.innerText = `æ­£åœ¨ä¸Šä¼  0 / ${files.length}`;

            for (let i = 0; i < files.length; i++) {
                let formData = new FormData();
                formData.append("file", files[i]);

                let response = await fetch("http://127.0.0.1:8000/upload/", {
                    method: "POST",
                    body: formData
                });

                let result = await response.json();
                console.log(`ä¸Šä¼ æˆåŠŸ: ${result.filename}`);

                // æ›´æ–°è¿›åº¦æ¡
                let percentComplete = Math.round(((i + 1) / files.length) * 100);
                progressBar.style.width = percentComplete + "%";
                progressText.innerText = `æ­£åœ¨ä¸Šä¼  ${i + 1} / ${files.length}`;
            }

            alert("âœ… æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ å®Œæˆï¼");
            progressText.innerText = "ä¸Šä¼ å®Œæˆï¼";
        }

        /** ğŸ—‘ æ¸…ç©ºå·²é€‰æ‹©çš„æ–‡ä»¶ */
        function clearFiles() {
            let fileInput = document.getElementById("fileInput");
            fileInput.value = "";  // æ¸…ç©ºæ–‡ä»¶è¾“å…¥æ¡†
            document.getElementById("progressContainer").classList.add("d-none");  // éšè—è¿›åº¦æ¡
        }

        /** ğŸ”„ ç¡®ä¿è·³è½¬åˆ° /static/results.htmlï¼Œé¿å…è·¯å¾„é—®é¢˜ */
        function redirectToResults() {
            window.location.href = "/static/results.html";  // ä½¿ç”¨**ç»å¯¹è·¯å¾„**æ–¹å¼è·³è½¬
        }
    </script>

</body>
</html>